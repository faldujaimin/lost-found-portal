{% extends "base.html" %}
{% block content %}
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card p-4 themed-panel glass">
                <div class="d-flex align-items-center">
                    <div style="width:96px; height:96px; flex:0 0 96px; border-radius:12px; overflow:hidden; background:#fff; display:flex; align-items:center; justify-content:center; position:relative;">
                        {# show user's avatar if available, otherwise fallback placeholder #}
                        {% if user.avatar_filename %}
                            <img src="{{ url_for('static', filename='uploads/' ~ user.avatar_filename) }}" alt="avatar" style="width:96px; height:96px; object-fit:cover; display:block;" />
                        {% else %}
                            <img src="{{ url_for('static', filename='uploads/Screenshot_538.png') }}" alt="avatar" style="width:88px; height:88px; object-fit:cover;" />
                        {% endif %}
                    </div>
                    <div style="margin-left:16px; flex:1 1 auto; display:flex; flex-direction:column; justify-content:center;">
                        <div style="display:flex; align-items:center;">
                            <div>
                                <h3 class="mb-1">{{ user.full_name }}</h3>
                                <p class="text-muted mb-1">{{ user.registration_no }} &middot; {{ user.role | capitalize }}</p>
                            </div>
                            <div style="margin-left:12px;">
                                <a href="{{ url_for('edit_profile') }}" class="btn btn-sm btn-outline-primary">Edit photo</a>
                            </div>
                        </div>
                        <div style="margin-top:8px;">
                            <span class="badge badge-primary" style="background:#f0c14b; color:#000; padding:.6rem .9rem; border-radius:8px; font-weight:700;">{{ user.level }}</span>
                            <span style="margin-left:12px; color:#6c757d;">Points: <strong>{{ user.points or 0 }}</strong></span>
                        </div>
                    </div>
                </div>

                <div style="margin-top:18px;">
                    <div style="display:flex; align-items:center; justify-content:space-between;">
                        <div style="font-weight:600;">Progress to {{ next_level or 'max' }}</div>
                        <div class="text-muted">{{ progress_pct }}%</div>
                    </div>
                    <style>
                        .progress-fill { height:100%; width:0; background:linear-gradient(90deg,#ffd54a,#ffb74d); transition: width 700ms ease; }
                    </style>
                    <div style="height:12px; background:#e9ecef; border-radius:8px; overflow:hidden; margin-top:8px;">
                        <div class="progress-fill" data-pct="{{ progress_pct }}"></div>
                    </div>
                    {% if points_to_next is not none and points_to_next > 0 %}
                        <p class="text-muted mt-2">Only <strong>{{ points_to_next }}</strong> points to reach <strong>{{ next_level }}</strong>.</p>
                    {% else %}
                        <p class="text-muted mt-2">You have reached the top level. Great job!</p>
                    {% endif %}
                </div>

                <hr />

                <h5>Recent reports</h5>
                {% if reports %}
                    <div class="list-group mt-2">
                        {% for r in reports %}
                            <a href="{{ url_for('item_detail', item_id=r.id) }}" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">{{ r.item_name }}</h6>
                                    <small class="text-muted">{{ r.status }}</small>
                                </div>
                                <p class="mb-1 text-muted">{{ r.description[:120] }}{% if r.description|length > 120 %}...{% endif %}</p>
                                <small class="text-muted">Reported: {{ r.reported_at.strftime('%Y-%m-%d') }}</small>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">You have not reported any items yet.</p>
                {% endif %}

            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            document.querySelectorAll('.progress-fill').forEach(function(el){
                var pct = el.getAttribute('data-pct') || '0';
                // clamp between 0 and 100
                var n = Math.max(0, Math.min(100, Number(pct)));
                el.style.width = n + '%';
            });
        });
    </script>
{% endblock content %}
